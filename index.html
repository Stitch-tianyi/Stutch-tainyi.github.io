<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>万部影视抢先版 - 今日访问量: 9999+</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            line-height: 1.6;
            padding: 15px;
            min-height: 100vh;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        .container {
            background: rgba(30, 30, 46, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            margin-bottom: 20px;
            backdrop-filter: blur(5px);
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            font-size: 24px;
            color: #ff7b00;
            margin-bottom: 10px;
            text-shadow: 0 2px 5px rgba(255, 123, 0, 0.4);
        }
        
        h2 {
            font-size: 20px;
            color: #ff7b00;
            margin: 18px 0 12px;
        }
        
        h3 {
            font-size: 18px;
            color: #ff7b00;
            margin: 15px 0 10px;
        }
        
        .subtitle {
            font-size: 16px;
            color: #ffb700;
            margin-bottom: 15px;
        }
        
        .stats {
            background: rgba(255, 123, 0, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-size: 15px;
        }
        
        .highlight {
            color: #ffb700;
            font-weight: bold;
        }
        
        .steps {
            margin: 20px 0;
        }
        
        .step {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #ff7b00;
            position: relative;
        }
        
        .step.locked {
            opacity: 0.7;
            border-left: 4px solid #666;
        }
        
        .step.locked::after {
            content: '\f023';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            top: 15px;
            right: 15px;
            color: #ff7b00;
            font-size: 20px;
        }
        
        .step-number {
            display: inline-block;
            background: #ff7b00;
            color: #fff;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            text-align: center;
            line-height: 28px;
            margin-right: 10px;
            font-weight: bold;
        }
        
        .step.locked .step-number {
            background: #666;
        }
        
        .note {
            background: rgba(0, 200, 220, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 18px 0;
            border-left: 4px solid #00c8dc;
        }
        
        .warning {
            background: rgba(255, 50, 50, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 18px 0;
            border-left: 4px solid #ff3232;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 16px;
            background: linear-gradient(90deg, #ff7b00 0%, #ff5500 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 25px 0 15px;
            box-shadow: 0 4px 10px rgba(255, 123, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 5px rgba(255, 123, 0, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(90deg, #3a3a5e 0%, #2a2a4e 100%);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        .btn:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #ffb700;
        }
        
        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .upload-area.active {
            border-color: #ff7b00;
            background: rgba(255, 123, 0, 0.05);
        }
        
        .upload-icon {
            font-size: 40px;
            color: #ff7b00;
            margin-bottom: 10px;
        }
        
        .upload-text {
            font-size: 14px;
            color: #aaa;
        }
        
        .success-message {
            text-align: center;
            padding: 20px;
            background: rgba(0, 200, 80, 0.1);
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #00c850;
        }
        
        .success-icon {
            font-size: 50px;
            color: #00c850;
            margin-bottom: 15px;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: #888;
            font-size: 12px;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        /* 进度条容器 */
        .progress-container {
            margin: 0 0 20px 0;
            padding: 15px;
            background: rgba(30, 30, 46, 0.95);
            border-radius: 0 0 12px 12px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .progress-percent {
            font-weight: bold;
            color: #ff7b00;
        }
        
        .progress-large {
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-large-inner {
            height: 100%;
            background: linear-gradient(90deg, #ff7b00 0%, #ff5500 100%);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .progress-text {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .progress-reward {
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .progress-reward i {
            color: #ffb700;
            margin-right: 5px;
        }
        
        /* 进度条动画效果 */
        .progress-large-inner::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: linear-gradient(
                -45deg,
                rgba(255, 255, 255, 0.2) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0.2) 75%,
                transparent 75%,
                transparent
            );
            z-index: 1;
            background-size: 20px 20px;
            animation: move 1s linear infinite;
            border-radius: 10px;
            overflow: hidden;
        }
        
        /* 上传图片预览 */
        .upload-preview {
            display: none;
            max-width: 100%;
            max-height: 150px;
            border-radius: 8px;
            margin-top: 10px;
            border: 2px solid rgba(255, 123, 0, 0.5);
        }
        
        /* 文件输入 */
        .file-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        /* 宣传图片 */
        .promo-image {
            width: 100%;
            max-width: 300px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid rgba(255, 123, 0, 0.5);
        }
        
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes move {
            0% { background-position: 0 0; }
            100% { background-position: 20px 20px; }
        }
        
        @keyframes glow {
            0% { box-shadow: 0 0 5px rgba(255, 123, 0, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 123, 0, 0.8); }
            100% { box-shadow: 0 0 5px rgba(255, 123, 0, 0.5); }
        }
        
        .glow {
            animation: glow 2s infinite;
        }
        
        /* 步骤完成动画 */
        .step-completed .step-number {
            background: #00c850;
            animation: pulse 1s;
        }
        
        .step-completed .step-title {
            color: #00c850;
        }
        
        .step-completed {
            border-left-color: #00c850;
        }
        
        /* 提示框 - 修复居中问题 */
        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 20px 25px;
            border-radius: 12px;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s;
            text-align: center;
            min-width: 280px;
            max-width: 90%;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }
        
        .toast.show {
            opacity: 1;
        }
        
        /* 验证错误提示 */
        .validation-error {
            color: #ff5252;
            font-size: 14px;
            margin-top: 5px;
            display: none;
            text-align: center;
        }
        
        /* 图片预览容器 */
        .image-preview-container {
            width: 100%;
            display: flex;
            justify-content: center;
            margin: 15px 0;
        }
        
        /* 模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            max-width: 90%;
            color: #333;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .modal-btn.confirm {
            background: #ff7b00;
            color: white;
        }
        
        .modal-btn.cancel {
            background: #e0e0e0;
            color: #333;
        }
        
        /* 新添加的样式 */
        .step-status {
            font-size: 14px;
            margin-top: 8px;
            color: #ffb700;
        }
        
        .step-status i {
            margin-right: 5px;
        }
        
        .step-status.completed {
            color: #00c850;
        }
    </style>
</head>
<body>
    <!-- 提示框 - 已修复居中问题 -->
    <div class="toast" id="toast"></div>
    
    <!-- 确认模态框 -->
    <div class="modal" id="confirm-modal">
        <div class="modal-content">
            <h3>确认保存图片</h3>
            <p>是否允许将宣传图片保存到您的相册？</p>
            <div class="modal-buttons">
                <button class="modal-btn cancel" id="modal-cancel">取消</button>
                <button class="modal-btn confirm" id="modal-confirm">确认保存</button>
            </div>
        </div>
    </div>

    <!-- 首页内容 -->
    <div class="container section active" id="section0">
        <header>
            <h1>万部影视抢先版</h1>
            <div class="subtitle">今日访问量: <span class="highlight">9999+</span></div>
            <div  class="image-preview-container"><img src="img/image.jpg" class="promo-image" /></div>
        </header>
        
        <div class="stats">
            <i class="fas fa-users"></i> 已有<span class="highlight">9999+</span>人次参与
        </div>
        
        <p>因为软件本身不需要付费也没有广告，所以请大家帮忙宣传下，设置了一点小任务防止同行捣乱</p>

        <!-- 进度条 -->
        <div class="progress-container">
            <div class="progress-info">
                <span>任务进度</span>
                <span class="progress-percent" id="progress-percent">0%</span>
            </div>
            <div class="progress-large">
                <div class="progress-large-inner" id="main-progress"></div>
                <div class="progress-text" id="progress-text">0%</div>
            </div>
            <div class="progress-reward">
                <i class="fas fa-gift"></i> 完成进度即可获取资源
            </div>
        </div>
        
        <div class="note">
            <i class="fas fa-info-circle"></i> 详细请看下面步骤
        </div>
        
        <button class="btn glow" id="start-task-btn">
            开始任务 <i class="fas fa-arrow-right"></i>
        </button>
        
        <div class="warning">
            <i class="fas fa-exclamation-triangle"></i> 声明：资源仅供学习交流，无不良引导
        </div>
    </div>

    <!-- 任务页面 -->
    <div class="container section" id="section1">
        <!-- 进度条 -->
        <div class="progress-container">
            <div class="progress-info">
                <span>任务进度</span>
                <span class="progress-percent" id="task-progress-percent">0%</span>
            </div>
            <div class="progress-large">
                <div class="progress-large-inner" id="task-progress"></div>
                <div class="progress-text" id="task-progress-text">0%</div>
            </div>
            <div class="progress-reward">
                <i class="fas fa-gift"></i> 完成进度即可获取资源
            </div>
        </div>

        <div  class="image-preview-container">
            <img src="img/image2.jpg" class="promo-image" />
        </div>

        <h2><i class="fas fa-tasks"></i> 任务步骤</h2>
        
        <div class="steps">
            <div class="step fade-in" id="step1">
                <span class="step-number">1</span>
                <span class="step-title">保存宣传图片</span>
                <p>点击下面按钮自动保存宣传图片到相册</p>
                
                <div class="image-preview-container">
                    <!-- 
                    ===============================================
                    程序员注意：在这里替换宣传图片的URL
                    将下面的URL替换为您自己的图片地址
                    ===============================================
                    -->
                    <img src="img/img.jpg" class="promo-image" id="promo-image">
                </div>
                
                <button class="btn btn-secondary" id="save-image-btn">
                    <i class="fas fa-download"></i> 自动保存宣传图片
                </button>
                
                <div class="step-status" id="step1-status">
                    <i class="fas fa-clock"></i> 未完成
                </div>
            </div>
            
            <div class="step fade-in locked" id="step2">
                <span class="step-number">2</span>
                <span class="step-title">平台评论任务</span>
                <p>打开小红书、抖音或快手任意一个平台，搜索与<strong>【子夜归全集完整版】</strong>相关的作品，找到最少3条，然后评论刚刚保存的图片并截图。</p>
                <button class="btn btn-secondary" id="complete-step2-btn" disabled>
                    <i class="fas fa-check"></i> 我已完成评论
                </button>
                
                <div class="step-status" id="step2-status">
                    <i class="fas fa-lock"></i> 请先完成步骤1
                </div>
            </div>
            
            <div class="step fade-in locked" id="step3">
                <span class="step-number">3</span>
                <span class="step-title">提交截图</span>
                <p>把截图在下面提交，提交完以后，AI机器人会自动审核，审核成功就会自动跳转到领取页。</p>
                 <div class="image-preview-container">
                    <img src="img/image.jpg" class="promo-image">
                </div>
                
                <p class="validation-error" id="validation-error">请上传三张不同的截图！</p>
                
                <div class="step-status" id="step3-status">
                    <i class="fas fa-lock"></i> 请先完成步骤2
                </div>
            </div>
        </div>
        
        <h3><i class="fas fa-upload"></i> 提交截图</h3>
        
        <form id="upload-form">
            <div class="form-group">
                <label>1. 评论第一张截图这里提交</label>
                <div class="upload-area" id="upload-area-1">
                    <input type="file" accept="image/*" class="file-input" id="file-input-1" disabled>
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="upload-text">请先完成步骤2解锁上传功能</div>
                    <img class="upload-preview" id="preview-1">
                    <div class="validation-error" id="error-1"></div>
                </div>
            </div>
            
            <div class="form-group">
                <label>2. 评论第二张截图这里提交</label>
                <div class="upload-area" id="upload-area-2">
                    <input type="file" accept="image/*" class="file-input" id="file-input-2" disabled>
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="upload-text">请先完成步骤2解锁上传功能</div>
                    <img class="upload-preview" id="preview-2">
                    <div class="validation-error" id="error-2"></div>
                </div>
            </div>
            
            <div class="form-group">
                <label>3. 评论第三张截图这里提交</label>
                <div class="upload-area" id="upload-area-3">
                    <input type="file" accept="image/*" class="file-input" id="file-input-3" disabled>
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="upload-text">请先完成步骤2解锁上传功能</div>
                    <img class="upload-preview" id="preview-3">
                    <div class="validation-error" id="error-3"></div>
                </div>
            </div>
            
            <button type="button" class="btn" id="submit-btn" disabled>
                <i class="fas fa-paper-plane"></i> 提交审核
            </button>
        </form>
        
        <button class="btn btn-secondary" id="back-to-home-btn">
            <i class="fas fa-arrow-left"></i> 返回首页
        </button>
    </div>

    <!-- 资源页面 -->
    <div class="container section" id="section2">
        <!-- 进度条 -->
        <div class="progress-container">
            <div class="progress-info">
                <span>任务进度</span>
                <span class="progress-percent" id="resource-progress-percent">100%</span>
            </div>
            <div class="progress-large">
                <div class="progress-large-inner" id="resource-progress" style="width: 100%"></div>
                <div class="progress-text" id="resource-progress-text">100%</div>
            </div>
            <div class="progress-reward">
                <i class="fas fa-gift"></i> 恭喜！您已成功完成任务
            </div>
        </div>
        
        <div class="success-message" id="success-message">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2>审核成功！</h2>
            <p>您的截图已通过AI审核，现在可以获取资源了</p>
        </div>
        
        <h2><i class="fas fa-download"></i> 资源获取方法</h2>
        
        <div class="warning">
            <i class="fas fa-exclamation-triangle"></i> 声明：本篇教程是我个人亲测之后一步步整理出来的，所有内容均不收费，如果有人搬运过去以收费为目的，请大家不要相信！！
        </div>
        
        <div class="steps">
            <div class="step">
                <span class="step-number">1</span>
                <span class="step-title">下载"悟空浏览器"</span>
            </div>
            
            <div class="step">
                <span class="step-number">2</span>
                <span class="step-title">用手机号登录</span>
            </div>
            
            <div class="step">
                <span class="step-number">3</span>
                <span class="step-title">搜索【雅婷资源】</span>
                <p>就会自动跳转影院，找到本剧即可</p>
            </div>
        </div>
        
        <div class="note">
            <i class="fas fa-lightbulb"></i> 提示：少数人操作以后还是没有解锁全集，说明资源被侵权下架了，一般情况下系统会在24小时内重新上架，这个时候咱们可以在影院内随便找个剧，看个半小时以后增加权重，然后过一会或者第二天再去搜索，就百分百解锁了。
        </div>
        
        <a href="https://wkbrowser.com/" class="btn pulse" id="download-btn">
            <i class="fas fa-check"></i> 我已完成，前往观看
        </a>
        
        <button class="btn btn-secondary" id="back-to-task-btn">
            <i class="fas fa-arrow-left"></i> 返回任务
        </button>
    </div>

    <footer>
        <p>© 2025 影视资源分享平台 - 仅供学习交流使用</p>
    </footer>

    <script>
        let uploadCount = 0;
        let progress = 0;
        let imageSaved = false;
        let step2Completed = false;
        let uploadedFiles = new Set(); // 用于存储已上传的文件名
        
        // 任务状态跟踪
        let taskStatus = {
            step1: false,
            step2: false,
            step3: false
        };
        
        // DOM元素引用
        const startTaskBtn = document.getElementById('start-task-btn');
        const saveImageBtn = document.getElementById('save-image-btn');
        const completeStep2Btn = document.getElementById('complete-step2-btn');
        const submitBtn = document.getElementById('submit-btn');
        const backToHomeBtn = document.getElementById('back-to-home-btn');
        const backToTaskBtn = document.getElementById('back-to-task-btn');
        const fileInput1 = document.getElementById('file-input-1');
        const fileInput2 = document.getElementById('file-input-2');
        const fileInput3 = document.getElementById('file-input-3');
        const validationError = document.getElementById('validation-error');
        const error1 = document.getElementById('error-1');
        const error2 = document.getElementById('error-2');
        const error3 = document.getElementById('error-3');
        const promoImage = document.getElementById('promo-image');
        const toast = document.getElementById('toast');
        const confirmModal = document.getElementById('confirm-modal');
        const modalConfirm = document.getElementById('modal-confirm');
        const modalCancel = document.getElementById('modal-cancel');
        
        // 步骤状态元素
        const step1Status = document.getElementById('step1-status');
        const step2Status = document.getElementById('step2-status');
        const step3Status = document.getElementById('step3-status');
        
        // 步骤元素
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const step3 = document.getElementById('step3');
        
        // 显示提示信息 - 已修复居中问题
        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // 显示确认模态框
        function showConfirmModal() {
            confirmModal.style.display = 'flex';
        }
        
        // 隐藏确认模态框
        function hideConfirmModal() {
            confirmModal.style.display = 'none';
        }
        
        // 切换页面
        function switchSection(sectionId) {
            document.querySelectorAll('.section').forEach((section, index) => {
                if(index === sectionId) {
                    section.classList.add('active');
                } else {
                    section.classList.remove('active');
                }
            });
            
            // 滚动到顶部
            window.scrollTo(0, 0);
        }
        
        // 保存宣传图片
        function savePromoImage() {
            // 创建画布并绘制自定义内容
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // 设置画布大小
            canvas.width = 300;
            canvas.height = 400;
            
            // 绘制背景
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#ff7b00');
            gradient.addColorStop(1, '#ff5500');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 绘制标题
            ctx.fillStyle = 'white';
            ctx.font = 'bold 28px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('子夜归', canvas.width/2, canvas.height/2 - 20);
            
            // 绘制副标题
            ctx.font = '20px Arial';
            ctx.fillText('38集全集完结版', canvas.width/2, canvas.height/2 + 20);
            
            // 绘制底部文字
            ctx.font = '16px Arial';
            ctx.fillText('万部影视抢先版', canvas.width/2, canvas.height - 30);
            
            // 将画布内容转换为数据URL
            const dataURL = canvas.toDataURL('image/jpeg');
            
            // 创建一个虚拟链接进行下载
            const link = document.createElement('a');
            link.href = dataURL;
            link.download = '子夜归宣传图.jpg';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // 显示提示
            showToast('图片已保存到相册！');
            
            // 标记图片已保存
            imageSaved = true;
            taskStatus.step1 = true;
            
            // 更新步骤1状态
            step1Status.innerHTML = '<i class="fas fa-check-circle"></i> 已完成';
            step1Status.classList.add('completed');
            
            // 解锁第二步
            unlockStep(2);
            
            // 更新进度
            updateProgress();
            
            // 隐藏模态框
            hideConfirmModal();
        }
        
        // 解锁指定步骤
        function unlockStep(stepNumber) {
            if (stepNumber === 2 && taskStatus.step1) {
                step2.classList.remove('locked');
                step2Status.innerHTML = '<i class="fas fa-clock"></i> 未完成';
                completeStep2Btn.disabled = false;
            } else if (stepNumber === 3 && taskStatus.step2) {
                step3.classList.remove('locked');
                step3Status.innerHTML = '<i class="fas fa-clock"></i> 未完成';
                
                // 启用文件上传
                fileInput1.disabled = false;
                fileInput2.disabled = false;
                fileInput3.disabled = false;
                
                // 更新上传区域文本
                document.querySelectorAll('.upload-text').forEach(el => {
                    el.textContent = '点击上传图片 (10MB以内)';
                });
            }
        }
        
        // 完成步骤
        function completeStep2() {
            const step = document.getElementById('step2');
            step.classList.add('step-completed');
            
            // 标记第二步完成
            step2Completed = true;
            taskStatus.step2 = true;
            
            // 更新步骤2状态
            step2Status.innerHTML = '<i class="fas fa-check-circle"></i> 已完成';
            step2Status.classList.add('completed');
            
            // 解锁第三步
            unlockStep(3);
            
            // 更新进度
            updateProgress();
        }
        
        // 验证图片是否重复
        function validateImage(file, areaId) {
            const fileName = file.name.toLowerCase();
            const errorElement = document.getElementById(`error-${areaId}`);
            
            // 检查是否已上传相同文件
            if (uploadedFiles.has(fileName)) {
                errorElement.textContent = '此图片已上传过，请选择不同的图片';
                errorElement.style.display = 'block';
                return false;
            }
            
            // 检查文件类型
            if (!file.type.startsWith('image/')) {
                errorElement.textContent = '请选择图片文件！';
                errorElement.style.display = 'block';
                return false;
            }
            
            // 检查文件大小 (10MB以内)
            if (file.size > 10 * 1024 * 1024) {
                errorElement.textContent = '文件大小不能超过10MB！';
                errorElement.style.display = 'block';
                return false;
            }
            
            // 验证通过，隐藏错误信息
            errorElement.style.display = 'none';
            return true;
        }
        
        // 处理文件选择
        function handleFileSelect(input, areaId) {
            const file = input.files[0];
            if (!file) return;
            
            // 验证图片
            if (!validateImage(file, areaId)) {
                return;
            }
            
            const area = document.getElementById(`upload-area-${areaId}`);
            const preview = document.getElementById(`preview-${areaId}`);
            const icon = area.querySelector('.upload-icon');
            const text = area.querySelector('.upload-text');
            
            // 显示上传中
            icon.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            text.textContent = '上传中...';
            
            // 读取文件并显示预览
            const reader = new FileReader();
            reader.onload = function(e) {
                // 模拟上传延迟
                setTimeout(() => {
                    // 显示预览
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    
                    // 更新图标和文本
                    icon.innerHTML = '<i class="fas fa-check" style="color: #00c850;"></i>';
                    text.textContent = '上传成功！点击可重新选择';
                    
                    // 增加上传计数
                    if (!area.classList.contains('uploaded')) {
                        area.classList.add('uploaded');
                        uploadCount++;
                        
                        // 添加到已上传文件集合
                        uploadedFiles.add(file.name.toLowerCase());
                    } else {
                        // 如果替换了图片，更新文件名
                        uploadedFiles.delete(area.dataset.originalFileName);
                        uploadedFiles.add(file.name.toLowerCase());
                    }
                    
                    // 保存原始文件名
                    area.dataset.originalFileName = file.name.toLowerCase();
                    
                    // 如果上传了至少一张图片，启用提交按钮
                    if (uploadCount >= 1) {
                        submitBtn.disabled = false;
                    }
                    
                    // 如果上传了三张图片，标记步骤3完成
                    if (uploadCount >= 3) {
                        taskStatus.step3 = true;
                        step3Status.innerHTML = '<i class="fas fa-check-circle"></i> 已完成';
                        step3Status.classList.add('completed');
                        step3.classList.add('step-completed');
                    }
                    
                    // 更新进度
                    updateProgress();
                    
                    // 隐藏全局验证错误
                    validationError.style.display = 'none';
                }, 1500);
            };
            reader.readAsDataURL(file);
        }
        
        // 验证并提交表单
        function validateAndSubmit() {
            // 检查是否上传了三张图片
            if (uploadCount < 3) {
                showToast(`请上传全部3张截图！您已上传${uploadCount}/3张`);
                return;
            }
            
            // 检查是否有重复图片
            if (uploadedFiles.size < 3) {
                validationError.textContent = '请上传三张不同的截图！';
                validationError.style.display = 'block';
                showToast('请上传三张不同的截图！');
                return;
            }
            
            submitForm();
        }
        
        // 更新进度条
        function updateProgress() {
            // 计算步骤完成进度 (最多60%)
            let stepsProgress = 0;
            if (taskStatus.step1) stepsProgress += 20;
            if (taskStatus.step2) stepsProgress += 20;
            if (taskStatus.step3) stepsProgress += 20;
            
            // 计算上传进度 (最多40%)
            const uploadProgress = Math.min(40, Math.round((uploadCount / 3) * 40));
            
            // 总进度
            progress = stepsProgress + uploadProgress;
            
            // 更新所有进度条
            const progressElements = [
                document.getElementById('main-progress'),
                document.getElementById('task-progress'),
                document.getElementById('resource-progress')
            ];
            
            const textElements = [
                document.getElementById('progress-text'),
                document.getElementById('task-progress-text'),
                document.getElementById('resource-progress-text')
            ];
            
            const percentElements = [
                document.getElementById('progress-percent'),
                document.getElementById('task-progress-percent'),
                document.getElementById('resource-progress-percent')
            ];
            
            progressElements.forEach(el => {
                if (el) el.style.width = `${progress}%`;
            });
            
            textElements.forEach(el => {
                if (el) el.textContent = `${progress}%`;
            });
            
            percentElements.forEach(el => {
                if (el) el.textContent = `${progress}%`;
            });
        }
        
        // 表单提交功能
        function submitForm() {
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 审核中...';
            
            // 模拟审核过程
            setTimeout(() => {
                // 显示成功消息
                document.getElementById('success-message').style.display = 'block';
                
                // 更新进度到100%
                progress = 100;
                updateProgress();
                
                // 3秒后跳转到资源页面
                setTimeout(() => {
                    switchSection(2);
                    submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> 提交审核';
                    submitBtn.disabled = false;
                }, 3000);
            }, 2000);
        }
        
        // 初始化事件监听
        function initEventListeners() {
            startTaskBtn.addEventListener('click', () => switchSection(1));
            saveImageBtn.addEventListener('click', () => {
                if (!taskStatus.step1) {
                    showConfirmModal();
                }
            });
            completeStep2Btn.addEventListener('click', () => {
                if (taskStatus.step1 && !taskStatus.step2) {
                    completeStep2();
                    showToast('步骤2已完成！');
                } else if (!taskStatus.step1) {
                    showToast('请先完成步骤1！');
                }
            });
            submitBtn.addEventListener('click', validateAndSubmit);
            backToHomeBtn.addEventListener('click', () => switchSection(0));
            backToTaskBtn.addEventListener('click', () => switchSection(1));
            
            fileInput1.addEventListener('change', () => {
                if (taskStatus.step2) {
                    handleFileSelect(fileInput1, 1);
                } else {
                    showToast('请先完成步骤2！');
                }
            });
            fileInput2.addEventListener('change', () => {
                if (taskStatus.step2) {
                    handleFileSelect(fileInput2, 2);
                } else {
                    showToast('请先完成步骤2！');
                }
            });
            fileInput3.addEventListener('change', () => {
                if (taskStatus.step2) {
                    handleFileSelect(fileInput3, 3);
                } else {
                    showToast('请先完成步骤2！');
                }
            });
            
            modalConfirm.addEventListener('click', savePromoImage);
            modalCancel.addEventListener('click', hideConfirmModal);
        }
        
        // 页面加载时初始化
        window.addEventListener('load', function() {
            document.querySelectorAll('.step').forEach((step, index) => {
                step.style.animationDelay = (index * 0.2) + 's';
            });
            
            // 初始化事件监听
            initEventListeners();
            
            // 初始化进度条
            updateProgress();
        });
    </script>
</body>
</html>